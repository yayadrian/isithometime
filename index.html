<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
 "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
   <title>Is it home time?</title>
   <meta name="description" content="Find out how much longer there is left of the work day. Is it home time yet?" />
   <script type="text/javascript" src="jquery-1.3.1.min.js"></script>
	<style type="text/css">@import "jquery.countdown.css";</style> 
	<script type="text/javascript" src="jquery.countdown.js"></script>
	
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>	
	<script type="text/javascript">
	//big yes no
	var d = new Date();
	var year = d.getFullYear();
	var month = d.getMonth();
	var realMonth = d.getMonth() + 1; //getMonth starts at 0
	var day = d.getDate();
	var hour = d.getHours();
	var minute = d.getMinutes();
	
	if (!hometime) {
		var hometime = new Date(year, month, day, 17, 30);
	}
	
	var worktime = new Date(year, month, day, 23, 59);
	
	function load() {
	//	var x = readCookie('hometimecookie') // ff
	//	if (x) { 
	//		//[do something with x]
	//	}
		setHomeTime();
		//set the count down timer
		$(function () {
			$('#messagediv').countdown({until: hometime, onExpiry: gohome, format: 'HMS'});
		});
		zeroTime();
			
	}
	
	function liftOff() { 
	    alert('We have lift off!'); 
	} 
	
	function isittime() {
		if (d > hometime) {
			return true;
		} else {
			return false;
		}	
	}
	
	// should be passing hometime in and not using a global var
	function setHomeTime() {
		if (isittime()){ //yep its home time
			document.getElementById('noHomeTime').style.display='none'
			document.getElementById('yesHomeTime').style.display='block'
			document.title = "Yes - it's home time"
			document.getElementById("isit").innerText = "Yes"
			document.getElementById("isit").innerHTML = "Yes"
		} else {
			document.getElementById('yesHomeTime').style.display='none'
			document.getElementById('noHomeTime').style.display='block'
			document.title = "No - it's not home time for you"
			document.getElementById("isit").innerText = "No"
			document.getElementById("isit").innerHTML = "No"
	
		}
	}
	
	function setTime() {
		if (document.getElementById('presentOrFuture').value == "tomorrow"){
			day = d.getDate()+1;
		} else {
			day = d.getDate();
		}
		
		hometime = new Date(year, month, day, document.getElementById('hours').value, document.getElementById('minutes').value)
		setHomeTime();
		//set the count down timer
		$(function () {
			$('#messagediv').countdown('change',{until: hometime});
		});	
		zeroTime();
	//	createCookie(hometime,7);
	}
	
	function hideCounter() {
		document.getElementById('messagediv').style.display = 'none'
	}
	
	function showCounter() {
		document.getElementById('messagediv').style.display = 'block'
	}
	
	function zeroTime() {
	// if the counter is at 0 0 0 
		if ($('#messagediv').countdown('getTimes')[6] == 0 && $('#messagediv').countdown('getTimes')[5] == 0 && $('#messagediv').countdown('getTimes')[4] == 0) {
			hideCounter();
		}	else {
			showCounter();
		}	
	}
	
	function gohome() {
		//alert("It's home time");
		hideCounter();
		//fix this, It's repeated all over the place bad bad bad
		document.getElementById('noHomeTime').style.display='none'
		document.getElementById('yesHomeTime').style.display='block'
		document.title = "Yes - it's home time"
		document.getElementById("isit").innerText = "Yes"
		document.getElementById("isit").innerHTML = "Yes"
	}
	
	// cookie fun time
	function createCookie(value,days) {
		if (days) {
			var date = new Date();
			date.setTime(date.getTime()+(days*24*60*60*1000));
			var expires = "; expires="+date.toGMTString();
		}
		else var expires = "";
		document.cookie = hometimecookie+"="+value+expires+"; path=/";
	}
	
	function readCookie(name) {
		var nameEQ = name + "=";
		var ca = document.cookie.split(';');
		for(var i=0;i < ca.length;i++) {
			var c = ca[i];
			while (c.charAt(0)==' ') c = c.substring(1,c.length);
			if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
		}
		return null;
	}
	
	
	</script>
	<link rel="stylesheet" href="style.css" type="text/css" />	
   <link rel="stylesheet" href="http://yui.yahooapis.com/2.7.0/build/reset-fonts-grids/reset-fonts-grids.css" type="text/css">
   <style type="text/css">
   #custom-doc { width: 100%; min-width: 250px; }
   </style>
</head>
<body onload="load()">
<div id="custom-doc" class="yui-t7">
   <div id="hd" role="banner">
   				<form>
			<select id="hours">
			  <option value="00">12 am</option>			
			  <option value="01">1 AM</option>
			  <option value="02">2 AM</option>
			  <option value="03">3 AM</option>
			  <option value="04">4 AM</option>
			  <option value="05">5 AM</option>
			  <option value="06">6 AM</option>
			  <option value="07">7 AM</option>
			  <option value="08">8 AM</option>
			  <option value="09">9 AM</option>
			  <option value="10">10 AM</option>
			  <option value="11">11 AM</option>
			  <option value="12">12 PM</option>
			  <option value="13">1 PM</option>
			  <option value="14">2 PM</option>
			  <option value="15">3 PM</option>
			  <option value="16">4 PM</option>
			  <option value="17" SELECTED>5 PM</option>
			  <option value="18">6 PM</option>
			  <option value="19">7 PM</option>
			  <option value="20">8 PM</option>
			  <option value="21">9 PM</option>
			  <option value="22">10 PM</option>
			  <option value="23">11 PM</option>
			  <option value="00">12 am</option>
			</select>
			
			<select id="minutes">
				<option value="00">00</option>
				<option value="01">01</option>
				<option value="02">02</option>
				<option value="03">03</option>
				<option value="04">04</option>
				<option value="05">05</option>
				<option value="06">06</option>
				<option value="07">07</option>
				<option value="08">08</option>
				<option value="09">09</option>
				<option value="10">10</option>
				<option value="11">11</option>
				<option value="12">12</option>
				<option value="13">13</option>
				<option value="14">14</option>
				<option value="15">15</option>
				<option value="16">16</option>
				<option value="17">17</option>
				<option value="18">18</option>
				<option value="19">19</option>
				<option value="20">20</option>
				<option value="21">21</option>
				<option value="22">22</option>
				<option value="23">23</option>
				<option value="24">24</option>
				<option value="25">25</option>
				<option value="26">26</option>
				<option value="27">27</option>
				<option value="28">28</option>
				<option value="29">29</option>
				<option value="30" selected="selected">30</option>
				<option value="31">31</option>
				<option value="32">32</option>
				<option value="33">33</option>
				<option value="34">34</option>
				<option value="35">35</option>
				<option value="36">36</option>
				<option value="37">37</option>
				<option value="38">38</option>
				<option value="39">39</option>
				<option value="40">40</option>
				<option value="41">41</option>
				<option value="42">42</option>
				<option value="43">43</option>
				<option value="44">44</option>
				<option value="45">45</option>
				<option value="46">46</option>
				<option value="47">47</option>
				<option value="48">48</option>
				<option value="49">49</option>
				<option value="50">50</option>
				<option value="51">51</option>
				<option value="52">52</option>
				<option value="53">53</option>
				<option value="54">54</option>
				<option value="55">55</option>
				<option value="56">56</option>
				<option value="57">57</option>
				<option value="58">58</option>
				<option value="59">59</option>	  		  
			</select>
			
			<select id="presentOrFuture">
				<option value="today">today</option>
				<option value="tomorrow">tomorrow</option>
			</select>
			
			<input type="submit" value="Set time" onclick="setTime();return false;"/>
		</form>	
   </div>
   <div id="bd" role="main">
	<div class="yui-g">
		<div id="yesno">
			<h1 id="isit">is it home time yet?</h1>
		</div>
	
		<div id="cuteMessage">
			
			<div id="noHomeTime" style="display: none;">
				No <fb:name uid="loggedinuser" firstnameonly="true" useyou="false" linked="true"></fb:name> it is not home time
				<p>
					<input type="button" onclick="callPublish('',{'name':'No it is not home time','href':'http://isithometime.com','description':'Sadly it is not home time just yet. Best get back to work'},null);return false;'Are you looking forward to home time?';" value="Let Facebook know that it is not hometime just yet" />
					<a href="http://twitter.com/home?status=Nope%20it%20is%20not%20home%20time%20just%20yet.%20I'll%20just%20keep%20waiting%20http%3A%2F%2Fisithometime.com">Let Twitter know</a>
				</p>
			</div>
			
			<div id="yesHomeTime" style="display: none;">
				Yes <fb:name uid="loggedinuser" firstnameonly="true" useyou="false" linked="true"></fb:name> It is Home Time get going
				<p>
					<input type="button" onclick="callPublish('',{'name':'Yes it is not home time','href':'http://isithometime.com','description':'Woohoo it is home time. Put that pen down and run home'},null);return false;'What are you planning to do now it is home time?';" value="Let Facebook know that it is hometime" />				
					<a href="http://twitter.com/home?status=Yay!%20It%20is%20time%20to%20go%20home%20now!%20http%3A%2F%2Fisithometime.com">Let Twitter know that it is hometime!</a>
				</p>
				
			</div>
		
			<div id="messagediv">
			</div>
			
		</div>
	</div>
</div>

<div id="madeby">
	<p>Made by <a href="http://facebook.com/adrianlansdown">Adrian Lansdown</a></p>
</div>
</body>

<script type="text/javascript">
	function callPublish(msg, attachment, action_link, user_message_prompt) {
	  FB.ensureInit(function () {
	    FB.Connect.streamPublish('', attachment, action_link, user_message_prompt);
	  });
	}
</script>
	<!-- Google stats -->
	<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	var pageTracker = _gat._getTracker("UA-735250-4");
	pageTracker._trackPageview();
	} catch(err) {}</script>
	<!-- Facebook -->
	 <script src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php/en_GB" type="text/javascript"></script><script type="text/javascript">FB.init("6b7cd06b17126343ef70dbf6ab5c6e8f");</script>

</html>